# 第一章：基础与资产准备

## 章节概述

在制作高质量的战斗动画之前，扎实的基础准备工作至关重要。本章将带你建立规范的项目结构，准备符合专业标准的角色模型、武器道具，并搭建高效的资产管理系统。这些看似枯燥的准备工作，将为后续的动画制作打下坚实基础，让你的工作流程更加顺畅高效。

**学习目标：**
- 掌握动画项目的标准文件组织结构
- 理解角色模型的技术规范和优化要点
- 学会制作符合动画需求的武器和道具
- 建立统一的材质贴图工作流程
- 构建可复用的资产库系统

## 1. 项目架构与文件管理

### 1.1 标准项目结构

一个专业的战斗动画项目需要清晰的文件组织结构。混乱的文件管理会严重影响制作效率，特别是在团队协作时。

```
project_root/
├── assets/              # 资产文件夹
│   ├── characters/      # 角色模型
│   │   ├── hero/       # 主角
│   │   ├── enemies/    # 敌人
│   │   └── npcs/       # NPC
│   ├── weapons/        # 武器
│   ├── props/          # 道具
│   ├── environments/   # 环境
│   └── fx/            # 特效资产
├── animations/         # 动画文件
│   ├── mocap_raw/     # 原始动捕数据
│   ├── cleaned/       # 清理后的动画
│   └── final/         # 最终动画
├── scenes/            # 场景文件
├── renders/           # 渲染输出
└── references/        # 参考资料
```

### 1.2 命名规范

统一的命名规范能避免很多不必要的麻烦：

- **角色**：`char_[类型]_[名称]_[版本]`
  - 例：`char_hero_traveler_v02.blend`
- **动画**：`anim_[角色]_[动作类型]_[编号]`
  - 例：`anim_traveler_attack_combo_01.blend`
- **武器**：`weap_[类型]_[名称]`
  - 例：`weap_sword_dullblade.blend`

### 1.3 版本控制策略

版本控制不仅仅是Git的事情，在3D制作中还需要考虑：

- **增量保存**：每个重要修改保存新版本
- **里程碑备份**：关键节点创建独立备份
- **缓存管理**：定期清理缓存文件避免项目臃肿

## 2. 角色模型规范

### 2.1 拓扑要求

良好的拓扑是动画变形的基础。战斗动画对模型拓扑要求特别高，因为会有大量的极限动作。

```
      肩部拓扑示例
    ╱────┬────╲
   ╱  ╱──┼──╲  ╲
  │  ╱   │   ╲  │
  │ │    │    │ │
  └─┴────┴────┴─┘
  
  环形边流保证变形
```

**关键区域的拓扑密度：**
- 肩部：至少3圈环形边
- 肘部：2-3圈环形边
- 膝盖：2-3圈环形边
- 脊椎：每个关节2圈边

### 2.2 骨骼系统设计

原神风格的角色通常采用以下骨骼结构：

```
        头部
          │
        颈部
          │
    ┌────脊椎────┐
    │            │
  左臂          右臂
    │            │
  左手          右手
    │
   骨盆
    │
  ┌─┴─┐
左腿  右腿
  │    │
左脚  右脚
```

**骨骼命名规范：**
- 使用`.L`和`.R`后缀区分左右
- 脊椎链：`spine_01`, `spine_02`, `spine_03`
- 手指：`finger_[index/middle/ring/pinky]_[01/02/03].L`

### 2.3 权重绘制技巧

权重绘制直接影响动画质量，特别是在关节处：

**肩部权重分布：**
- 上臂骨：主要影响区域
- 锁骨：辅助影响，平滑过渡
- 脊椎：少量影响，保持连续性

**常见权重问题：**
- 关节处出现"糖果纸"扭曲
- 极限姿势下的穿模
- 权重断层导致的硬边

## 3. 武器与道具制作标准

### 3.1 武器建模规范

武器需要在细节和性能间找到平衡：

**多边形数量建议：**
- 单手剑：3000-5000面
- 双手剑：4000-6000面
- 法器：2000-4000面
- 弓：3000-4500面

### 3.2 枢轴点设置

正确的枢轴点对动画至关重要：

```
剑的枢轴点位置：
     刀刃
       │
    ───┼───
       │
     护手
       │
    ▼ 枢轴点（握把底部）
```

### 3.3 碰撞体设置

为武器添加简化的碰撞体：
- 使用简单几何体近似
- 确保覆盖主要攻击区域
- 避免过于复杂的碰撞形状

## 4. 材质与贴图工作流

### 4.1 PBR材质规范

原神采用风格化的PBR渲染：

**贴图通道：**
- Base Color：基础色
- Metallic：金属度
- Roughness：粗糙度
- Normal：法线
- Emission：自发光（元素效果）

### 4.2 贴图分辨率标准

根据资产重要性分配贴图分辨率：

- **主角**：4K (4096×4096)
- **重要NPC**：2K (2048×2048)
- **普通敌人**：1K-2K
- **武器**：1K-2K
- **小道具**：512-1K

### 4.3 UV展开原则

高效的UV布局能最大化贴图利用率：

```
UV布局示例：
┌─────────────┐
│ 头部  │躯干 │
│       │     │
├───────┼─────┤
│手臂│腿│其他│
└─────────────┘
```

## 5. 资产库的建立与管理

### 5.1 资产分类系统

建立清晰的分类体系：

**角色分类：**
- 按元素：火、水、冰、雷、风、岩、草
- 按武器：单手剑、双手剑、长柄、法器、弓
- 按稀有度：5星、4星、3星

### 5.2 预设库建设

创建常用的预设提高效率：

**动作预设：**
- 基础站立姿势
- 战斗准备姿势
- 常用手势库

**材质预设：**
- 金属材质组
- 布料材质组
- 皮肤材质组

### 5.3 资产链接与管理

使用Blender的链接系统管理资产：

- **Link**：链接外部文件，保持同步更新
- **Append**：导入并本地化，独立编辑
- **Library Override**：链接的同时允许局部修改

## 本章小结

本章我们建立了战斗动画项目的基础框架：

- **项目管理**：规范的文件结构和命名规则是高效工作的前提
- **模型规范**：良好的拓扑和骨骼系统是动画质量的保证
- **资产标准**：统一的制作标准确保资产的一致性和可复用性
- **工作流程**：建立标准化流程提高制作效率

记住，这些看似繁琐的准备工作会在后续制作中节省大量时间。一个混乱的项目会让简单的修改变得困难重重，而良好的组织则让复杂的制作变得有条不紊。

## 练习题

### 基础题

**练习1.1：项目结构创建**
创建一个新的战斗动画项目，按照本章介绍的标准目录结构组织文件。包含至少一个角色、两种武器和一个测试场景。

<details>
<summary>💡 提示</summary>

使用脚本批量创建文件夹结构，确保每个文件夹都有清晰的用途说明文档。

</details>

<details>
<summary>📝 参考答案</summary>

1. 创建主目录和所有子目录
2. 在每个目录下创建README.md说明文件用途
3. 设置.gitignore忽略缓存和临时文件
4. 创建项目配置文件记录贴图分辨率、多边形数量等标准

</details>

**练习1.2：角色拓扑检查**
下载一个免费的角色模型，检查其拓扑是否适合战斗动画。列出至少5个需要改进的地方。

<details>
<summary>💡 提示</summary>

重点检查肩部、肘部、膝盖等关节区域的边流。使用Blender的线框显示模式观察。

</details>

<details>
<summary>📝 参考答案</summary>

常见问题：
1. 肩部缺少环形边流
2. 肘部三角面过多
3. 膝盖弯曲处边线密度不足
4. 手腕没有足够的循环边
5. 脊椎区域拓扑不均匀

</details>

**练习1.3：骨骼创建与命名**
为一个简单的人形模型创建基础骨骼系统，严格遵循命名规范。

<details>
<summary>💡 提示</summary>

使用Blender的Armature工具，从骨盆开始构建。记得使用X-Axis Mirror保证对称。

</details>

<details>
<summary>📝 参考答案</summary>

骨骼层级：
- root
  - pelvis
    - spine_01 → spine_02 → spine_03 → neck → head
    - thigh.L → shin.L → foot.L → toe.L
    - thigh.R → shin.R → foot.R → toe.R
  - clavicle.L → upper_arm.L → forearm.L → hand.L
  - clavicle.R → upper_arm.R → forearm.R → hand.R

</details>

**练习1.4：UV展开优化**
将一个1024×1024的武器模型贴图优化到512×512，同时保持视觉质量。

<details>
<summary>💡 提示</summary>

识别哪些部分最重要（刃部、装饰），给予更多UV空间。隐藏部分可以缩小。

</details>

<details>
<summary>📝 参考答案</summary>

优化策略：
1. 合并相似/对称的部分共用UV
2. 隐藏面删除或极度缩小
3. 重要细节（刃部、纹饰）保持较大UV空间
4. 使用Texel Density检查工具确保密度均匀
5. 考虑使用平铺贴图处理重复图案

</details>

### 挑战题

**练习1.5：批量资产处理脚本**
编写一个Blender Python脚本，自动检查目录下所有模型文件的多边形数量、贴图分辨率，并生成报告。

<details>
<summary>💡 提示</summary>

使用bpy.data.meshes获取网格信息，bpy.data.images获取贴图信息。考虑使用CSV格式输出报告。

</details>

<details>
<summary>📝 参考答案</summary>

脚本功能要点：
1. 遍历指定目录的.blend文件
2. 加载每个文件并分析：
   - 多边形数量统计
   - 贴图尺寸检查
   - 骨骼数量统计
   - 材质槽位数量
3. 生成HTML或CSV格式报告
4. 标记超出规范的资产
5. 可选：自动优化简单问题

</details>

**练习1.6：模块化武器系统**
设计一个模块化的武器系统，可以通过组合不同部件快速生成新武器。至少包含3种刀刃、3种护手、3种握把。

<details>
<summary>💡 提示</summary>

使用Collection Instance实现模块化，确保每个部件的连接点对齐。考虑使用自定义属性控制组合。

</details>

<details>
<summary>📝 参考答案</summary>

系统设计：
1. 标准化连接点（使用Empty作为锚点）
2. 每个部件独立Collection
3. 主控制器使用Custom Properties切换部件
4. 驱动器自动更新材质和属性
5. 预设系统保存常用组合
6. 自动命名系统根据部件组合生成名称

</details>

**练习1.7：权重自动传递系统**
创建一个工作流，能够将一个角色的权重自动传递到相似拓扑的其他角色上。

<details>
<summary>💡 提示</summary>

使用Transfer Weights功能，但需要处理拓扑差异。考虑使用Shrinkwrap修改器对齐网格。

</details>

<details>
<summary>📝 参考答案</summary>

工作流程：
1. 创建标准参考模型和权重
2. 使用Shrinkwrap将新模型贴合到参考模型
3. Transfer Weights传递权重
4. 手动微调问题区域
5. 保存权重预设供后续使用
6. 建立不同体型的权重模板库

</details>

**练习1.8：资产依赖关系图**
为一个包含5个角色、10种武器的项目创建资产依赖关系图，识别共享资源并优化。

<details>
<summary>💡 提示</summary>

考虑贴图共享、材质复用、动画复用等。使用图表工具可视化依赖关系。

</details>

<details>
<summary>📝 参考答案</summary>

优化要点：
1. 识别共享贴图（如金属、布料通用贴图）
2. 建立材质库减少重复
3. 分析哪些动画可以在角色间共享
4. 创建LOD系统减少渲染负担
5. 使用实例化减少内存占用
6. 建立资产更新追踪系统

</details>

## 常见陷阱与错误

### 🚫 陷阱1：过早优化模型

**问题**：在动画需求明确前就过度优化模型，导致后期修改困难。

**解决方案**：
- 保留高模作为源文件
- 使用修改器非破坏性工作
- 分阶段优化，动画确定后再做最终优化

### 🚫 陷阱2：忽视比例统一

**问题**：不同资产使用不同的比例单位，导致合并场景时大小混乱。

**解决方案**：
- 项目开始就确定统一单位（建议用米）
- 创建参考物体（如1.7m的标准人物）
- 导入新资产立即检查并调整比例

### 🚫 陷阱3：骨骼朝向不一致

**问题**：骨骼的局部坐标轴朝向混乱，导致动画控制困难。

**解决方案**：
- 统一使用相同的骨骼朝向（如Y轴沿骨骼方向）
- 使用Recalculate Roll功能修正
- 建立骨骼模板确保一致性

### 🚫 陷阱4：贴图通道混淆

**问题**：不同软件间贴图通道定义不同，导致材质错误。

**解决方案**：
- 明确定义每个通道的用途
- 使用标准命名（如_BaseColor, _Normal, _Roughness）
- 创建材质转换预设

### 🚫 陷阱5：版本管理混乱

**问题**：没有清晰的版本记录，不知道哪个是最新文件。

**解决方案**：
- 使用版本号而非日期
- 保持更新日志
- 定期归档旧版本

---

准备工作虽然枯燥，但这是专业制作的基石。下一章，我们将开始激动人心的动作捕捉学习！